<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ramo de Tulipanes</title>
  <meta name="description" content="Para mi novia" />
  <style>
    :root{
      --background-image: img/fondo.png;
      --background-size: cover;
      --background-position: center;
      --background-attachment: fixed;
      --destello: rgba(255,255,255,0.88);
      --accent: #ff7ab6;
      --text: #2c2c2c;
      --blur-strength: 6px;

      /* Ajustables */
      --tulip-width: 240px;
      --tulip-overlap: 110px;

      --page-padding: 18px;
      --max-width: 1200px;
      --shadow: 0 12px 30px rgba(0,0,0,0.12);
      --radius: 18px;
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;overflow:hidden}
    body {
      background-image: url('img/fondo.png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--page-padding);
      color: var(--text);
    }

    #stage{
      position:relative;
      width:100%;
      max-width:var(--max-width);
      height:100vh;
      border-radius:12px;
      background:linear-gradient(180deg, rgba(255,255,255,0.45), rgba(255,255,255,0.15));
      box-shadow:var(--shadow);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }

    /* Destellos */
    .shimmer{position:absolute;inset:0;pointer-events:none;z-index:2;
      background-image:
        radial-gradient(ellipse at 25% 20%, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.0) 20%),
        radial-gradient(ellipse at 75% 80%, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.0) 22%);
      opacity:0.9;mix-blend-mode:screen;filter:blur(6px);
      animation: shimmerMove 10s linear infinite;
    }
    @keyframes shimmerMove{0%{transform:translate(-6%,-4%) scale(1)}50%{transform:translate(6%,4%) scale(1.02)}100%{transform:translate(-6%,-4%) scale(1)}}

    /* Ramo centrado abajo - tulipanes solapados */
    .ramo{
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display:flex;
      align-items:flex-end;
      justify-content:center;
      gap:0;
      z-index: 20;
      pointer-events: auto;
    }
    .tulip-wrap{
      width: var(--tulip-width);
      display:flex;
      align-items:flex-end;
      justify-content:center;
      transform-origin: 50% 100%;
      opacity: 0;
      transform: translateY(18px) scale(.95);
      margin-left: calc(-1 * var(--tulip-overlap));
    }
    .tulip-wrap:first-child{ margin-left: 0; }

    /* apilamiento/rotaciones naturales */
    .tulip-wrap.pos1{ z-index: 2; transform: translateY(14px) rotate(-8deg) scale(.98); }
    .tulip-wrap.pos2{ z-index: 4; transform: translateY(8px) rotate(6deg) scale(1.06); } /* centro al frente */
    .tulip-wrap.pos3{ z-index: 1; transform: translateY(0px) rotate(-2deg) scale(.98); }

    .tulip{
      width:100%;
      height:auto;
      display:block;
      border-radius:12px;
      cursor:pointer;
      user-select:none;
      box-shadow:0 14px 34px rgba(0,0,0,0.16);
      transition: transform .26s cubic-bezier(.2,.9,.3,1), filter .18s;
      will-change: transform, filter;
    }
    .tulip:active{ transform: translateY(6px) scale(.98); }
    .tulip:hover{ transform: translateY(-4px) scale(1.02); }

    /* animación de entrada */
    .tulip-wrap:nth-child(1){animation: popIn .7s .05s both cubic-bezier(.2,.9,.3,1)}
    .tulip-wrap:nth-child(2){animation: popIn .7s .12s both cubic-bezier(.2,.9,.3,1)}
    .tulip-wrap:nth-child(3){animation: popIn .7s .19s both cubic-bezier(.2,.9,.3,1)}
    @keyframes popIn{0%{opacity:0;transform:translateY(18px) scale(.95)}60%{opacity:1;transform:translateY(-6px) scale(1.03)}100%{opacity:1;transform:translateY(0) scale(1)}}

    .ramo:after{
      content:'';
      position:absolute;
      bottom:8%;
      left:50%;
      transform:translateX(-50%);
      width:56%;
      height:18px;
      background:radial-gradient(ellipse at center, rgba(0,0,0,0.12), rgba(0,0,0,0.0));
      border-radius:50%;
      z-index:1;
    }

    /* Overlay / dialog (dialog con fondo sólido para legibilidad) */
    .overlay{
      position:fixed;
      inset:0;
      display:none;
      align-items:flex-start; /* aparece hacia arriba */
      justify-content:center;
      background:rgba(0,0,0,0.36);
      z-index:10000; /* poner por encima de ramo */
      padding-top:6vh;
      padding-bottom:20px;
    }
    .overlay.show{ display:flex; }

    .dialog{
      background:#ffffff;
      width:calc(100% - 36px);
      max-width:640px;
      border-radius:16px;
      padding:24px;
      box-shadow:0 18px 40px rgba(0,0,0,0.22);
      text-align:center;
      transition: all .28s ease;
      z-index:10001;
    }
    .dialog h2{ margin:0 0 10px; color:var(--accent); font-size:26px; }
    .dialog p{ margin:0; color:var(--text); line-height:1.5; font-size:18px; }

    /* Blur aplicado al ramo cuando modal abierto */
    .ramo.blurred{ filter: blur(var(--blur-strength)); transition: filter .24s; pointer-events: none; opacity: 0.99; }

    /* audio control button */
    .audio-control{ position: absolute; top:18px; right:18px; z-index:10100; display:flex; align-items:center; gap:8px; background:rgba(255,255,255,0.9); backdrop-filter: blur(6px); padding:8px 12px; border-radius:999px; box-shadow:0 8px 20px rgba(0,0,0,0.08); }
    .audio-control button{ border:none; background:none; cursor:pointer; font-weight:700; color:var(--accent); font-size:15px; }

    .note{ position:absolute; left:20px; bottom:18px; font-size:13px; color:#666; z-index:80; }

    @media (max-width:720px){
      :root{ --tulip-width: 180px; --tulip-overlap: 90px; }
      .dialog{ padding:16px; }
    }

    /* ocultar reproductor nativo */
    audio{ display:none; }

  </style>
</head>
<body>
  <div id="stage" role="main" aria-label="Ramo de tulipanes interactivo">
    <div class="shimmer" aria-hidden="true"></div>

    <div class="audio-control" id="audioControl" title="Control de música">
      <button id="playBtn" aria-label="Reproducir/pausar">▶︎</button>
      <span style="font-size:13px;color:#333">Música</span>
    </div>

    <div class="ramo" id="ramo" aria-hidden="false">
      <div class="tulip-wrap pos1"><img class="tulip" src="img/tulip.png" alt="Tulipán 1" data-index="0"></div>
      <div class="tulip-wrap pos2"><img class="tulip" src="img/tulip.png" alt="Tulipán 2" data-index="1"></div>
      <div class="tulip-wrap pos3"><img class="tulip" src="img/tulip.png" alt="Tulipán 3" data-index="2"></div>
    </div>
  </div>

  <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="dialog" id="dialog">
      <h2 id="dialogTitle">Espera</h2>
      <p id="dialogText">Presiona cada tulipán</p>
    </div>
  </div>

  <!-- audio en el DOM (usa el enlace de Drive convertido a descarga directa) -->
  <audio id="bg-music" loop>
    <source src="https://docs.google.com/uc?export=download&id=1VKw9AfTziD_mw7kVuIvX4eybVG-e9daG" type="audio/mpeg">
    Tu navegador no soporta audio HTML5.
  </audio>

  <script>
    /* -------------------------
       CONFIGURACIÓN
       ------------------------- */
    const MESSAGES = [
      { title: "Mi amor", text: "Te quiero" },
      { title: "Mi novia", text: "Te adoro" },
      { title: "Mi vida", text: "Te amo!" }
    ];

    const TULIP_URLS = [
      'img/tulip.png',
      'img/tulip.png',
      'img/tulip.png'
    ];

    /* -------------------------
       LÓGICA
       ------------------------- */
    const tulips = document.querySelectorAll('.tulip');
    const overlay = document.getElementById('overlay');
    const dialogTitle = document.getElementById('dialogTitle');
    const dialogText = document.getElementById('dialogText');
    const stage = document.getElementById('stage');
    const playBtn = document.getElementById('playBtn');
    const ramoEl = document.getElementById('ramo');
    let currentIndex = 0;

    function applyTulips(){
      document.querySelectorAll('.tulip').forEach((img,i)=> img.src = TULIP_URLS[i % TULIP_URLS.length]);
    }
    applyTulips();

    function openModal(i){
      currentIndex = i;
      dialogTitle.textContent = MESSAGES[i].title;
      dialogText.textContent = MESSAGES[i].text;
      overlay.classList.add('show');
      overlay.setAttribute('aria-hidden','false');
      if (ramoEl) ramoEl.classList.add('blurred');
    }
    function closeModal(){
      overlay.classList.remove('show');
      overlay.setAttribute('aria-hidden','true');
      if (ramoEl) ramoEl.classList.remove('blurred');
    }

    // click en cada flor -> abrir modal (y arrancar audio si es posible)
    tulips.forEach((t, idx) => {
      t.addEventListener('click', () => {
        openModal(idx);
        const audioEl = document.getElementById('bg-music');
        if (audioEl && audioEl.paused) {
          audioEl.play().then(()=>{ if (playBtn) playBtn.textContent='⏸'; }).catch(()=>{ /* bloqueado */ });
        }
      });
    });

    // cerrar modal tocando fuera o con ESC
    overlay.addEventListener('click', (e) => { if (e.target === overlay) closeModal(); });
    window.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });

    /* -------------------------
       AUDIO: intento autoplay + control del botón
       ------------------------- */
    document.addEventListener('DOMContentLoaded', function () {
      const audio = document.getElementById('bg-music');
      if (!audio) return;
      audio.volume = 0.6;

      const tryPlay = () => {
        audio.play().then(()=>{
          if (playBtn) playBtn.textContent = '⏸';
        }).catch((err)=>{
          console.log('Autoplay bloqueado (normal en móviles):', err);
        });
      };

      // intento inicial (puede ser bloqueado)
      tryPlay();

      // fallback: arrancar en primer click del usuario
      document.body.addEventListener('click', tryPlay, { once: true });

      // control del botón
      if (playBtn) {
        playBtn.addEventListener('click', (e)=>{
          e.stopPropagation();
          if (audio.paused) {
            audio.play().then(()=>{ playBtn.textContent='⏸'; }).catch(()=>{});
          } else {
            audio.pause();
            playBtn.textContent='▶︎';
          }
        });
      }
    });
  </script>
</body>
</html>
